{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\cggl\\material\\category.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\cggl\\material\\category.vue","mtime":1635216068737},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getAllMaterialCategory, deleteMaterialCategory, getMaterialCategoryPropertyByCategoryId, DeleteMaterialCategoryProperty } from '@/api/cggl/material'\r\nimport AddMaterial from './components/addMaterial'\r\nimport AddMCPItem from './components/addMCPItem'\r\nimport AddRangeMCP from './components/addRangeMCP'\r\nimport CopyTo from './components/copyTo'\r\nimport AddMaterialCategoryProperty from './components/addMaterialCategoryProperty'\r\nimport { getTree } from '@/utils/index'\r\n\r\nexport default {\r\n  name: 'MaterialCategory',\r\n  components: {\r\n    AddMaterial,\r\n    AddMaterialCategoryProperty,\r\n    AddMCPItem,\r\n    AddRangeMCP,\r\n    CopyTo\r\n  },\r\n  data() {\r\n    return {\r\n      list: null,\r\n      listLoading: false,\r\n      dialogTableVisible: false,\r\n      dialogTitle: '保存',\r\n\r\n      tableList: [],\r\n      tableListLoading: false,\r\n\r\n      total: 0,\r\n      currentPage: 1,\r\n      pageSize: this.utils.getPersonalSettings().pageSize,\r\n\r\n      currentRow: null,\r\n      // currentCategoryName: '',\r\n      currentCategory: null,\r\n      checkedNodes: [],\r\n      comName: 'AddMaterial',\r\n      pid: 0,\r\n      buttonLoading: false,\r\n\r\n      expandIds: [],\r\n\r\n      filterText: '',\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'label'\r\n      },\r\n      companyId: this.$store.state.user.selectOrgId\r\n    }\r\n  },\r\n  watch: {\r\n    filterText(val) {\r\n      this.$refs.tree.filter(val)\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getCategory()\r\n  },\r\n  methods: {\r\n    getCategory() {\r\n      getAllMaterialCategory().then(response => {\r\n        response.data.forEach(element => {\r\n          element.pid = element.pId\r\n          element.label = element.number + ' ' + element.name\r\n          delete element.pId\r\n        })\r\n        this.list = getTree(0, response.data)\r\n      })\r\n    },\r\n    addCategoryClose(pid) {\r\n      this.expandIds = [pid]\r\n      this.dialogTableVisible = false\r\n      this.getCategory()\r\n    },\r\n    addItemClose() {\r\n      this.dialogTableVisible = false\r\n      if (this.currentRow) { this.getProperty(this.currentRow.categoryId) }\r\n      // this.getProperty(this.currentCategory.categoryId)\r\n    },\r\n    addProClose() {\r\n      this.dialogTableVisible = false\r\n      if (this.currentCategory) { this.getProperty(this.currentCategory.id) }\r\n    },\r\n    filterNode(value, data) {\r\n      if (!value) return true\r\n      return data.label.indexOf(value) !== -1\r\n    },\r\n    addCategory() {\r\n      this.dialogTitle = '添加类别'\r\n      this.currentRow = null\r\n      this.pid = 0\r\n      this.comName = 'AddMaterial'\r\n      this.dialogTableVisible = true\r\n    },\r\n    handleEdit(row) {\r\n      this.dialogTitle = '编辑属性 - ' + this.currentCategory.label\r\n      this.currentRow = row\r\n      this.comName = 'AddMCPItem'\r\n      this.dialogTableVisible = true\r\n    },\r\n    remove(node, data) {\r\n      // console.log('node:', node)\r\n      // console.log('data:', data)\r\n      if (node.childNodes.length) {\r\n        this.$message.warning('请先删除下级类别')\r\n        return\r\n      }\r\n      this.$confirm('是否确定删除?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        deleteMaterialCategory({ id: data.id }).then(response => {\r\n          this.getCategory()\r\n          this.$message(response.message)\r\n        })\r\n      }).catch(() => {\r\n        this.$message.info('已取消')\r\n      })\r\n    },\r\n    update(data) {\r\n      this.dialogTitle = '类别名称修改'\r\n      this.comName = 'AddMaterial'\r\n      this.currentRow = data\r\n      this.dialogTableVisible = true\r\n    },\r\n    handleNodeClick(data, node) {\r\n      // console.log('node节点信息:', node)\r\n      this.currentRow = null\r\n      if (node.level === 3) {\r\n        this.currentCategory = data\r\n        this.getProperty(data.id)\r\n        this.currentRow = data\r\n      } else {\r\n        // this.$message('必须是三级目录')\r\n        this.currentCategory = null\r\n        this.tableList = []\r\n      }\r\n    },\r\n    getProperty(categoryId) {\r\n      this.tableListLoading = true\r\n      getMaterialCategoryPropertyByCategoryId({ categoryId: categoryId }).then(response => {\r\n        this.tableList = response.data\r\n        this.tableListLoading = false\r\n      }).catch(() => { this.tableListLoading = false })\r\n    },\r\n    AddPropertyforCategory() {\r\n      if (this.currentRow === null) {\r\n        this.$message.warning('请选中')\r\n        return false\r\n      }\r\n      this.comName = 'AddMaterialCategoryProperty'\r\n      this.dialogTableVisible = true\r\n    },\r\n    handleDel(row) {\r\n      this.$confirm('是否确定删除？', '警告', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        DeleteMaterialCategoryProperty({ id: row.id }).then(response => {\r\n          this.getProperty(row.categoryId)\r\n          this.$message.success(response.message)\r\n        })\r\n      }).catch(() => {\r\n        this.$message.info('已取消删除')\r\n      })\r\n    },\r\n    addPro() {\r\n      // 获取所有子节点\r\n      var nodes = this.$refs.tree.getCheckedNodes(true, false)\r\n      if (!nodes.length) {\r\n        this.$message.warning('请选择节点，可多选')\r\n        return false\r\n      }\r\n      this.dialogTitle = '批量添加属性'\r\n      this.checkedNodes = nodes\r\n      this.comName = 'AddRangeMCP'\r\n      this.dialogTableVisible = true\r\n    },\r\n    copyTo() {\r\n      // 获取所有子节点\r\n      var nodes = this.$refs.tree.getCheckedNodes(true, false)\r\n      if (!nodes.length) {\r\n        this.$message.warning('请选择要复制的节点，可多选')\r\n        return false\r\n      }\r\n      this.dialogTitle = '批量复制属性'\r\n      this.checkedNodes = nodes\r\n      this.comName = 'CopyTo'\r\n      this.dialogTableVisible = true\r\n    }\r\n  }\r\n}\r\n",null]}