{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\fbgl\\fbht\\SubcontractAssesment\\details.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\fbgl\\fbht\\SubcontractAssesment\\details.vue","mtime":1635844823966},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { GetSubcontractAssesmentAttitudeById, SealSubcontractAssesment, SaveSubcontractAssesment, CheckSubcontractAssesment, DeleteSubcontractSignSet } from '@/api/fbgl/subcontractAssesment.js'\r\nimport FlowDisplay from '@/components/Flow/flowDisplay'\r\nimport FlowAttitude from '@/components/Flow/flowAttitude'\r\nimport Detailsedit from '@/components/Detailsedit'\r\nimport UpFile from '@/components/UpLoad/UpFile'\r\nexport default {\r\n  name: 'SubcontractAssesmentDetails',\r\n  components: {\r\n    FlowDisplay,\r\n    FlowAttitude,\r\n    Detailsedit,\r\n    UpFile\r\n  },\r\n  data() {\r\n    return {\r\n      type: 'details', // 审核:approval 详情:details 支付:pay\r\n      size: 'mini',\r\n      filter: {\r\n        stateOptions: [ // 状态数组\r\n        ]\r\n      },\r\n      fileList: [],\r\n      activeNames: ['0', '1', '2'], // 展开的折叠面板\r\n      saveLoading: false,\r\n      myDetails: null, // 详情数据\r\n      billFlowData: null, // 流程信息\r\n      attitudePara: null // 审批信息\r\n    }\r\n  },\r\n  computed: {\r\n    state() {\r\n      return this.myDetails?.data?.state\r\n    },\r\n    /**\r\n     * 详情各字段计算\r\n     */\r\n    infoList() {\r\n      const {\r\n        myDetails: {\r\n          data: {\r\n            orgName,\r\n            name,\r\n            number,\r\n            subcontractType,\r\n            projectName,\r\n            subcontractor,\r\n            corporation,\r\n            subcontractPeople,\r\n            secondParty,\r\n            remark,\r\n            isSeal,\r\n            createUserName,\r\n            createDate,\r\n            lastEditUserName,\r\n            lastEditDate,\r\n            contractStartDate,\r\n            contractFinishDate,\r\n            contractAmount,\r\n            contractDuration,\r\n            repairYear,\r\n            taxRate,\r\n            settlePaymentScale,\r\n            subPart,\r\n            paymentTerms,\r\n            acceptenceScale,\r\n            settleReportScale,\r\n            progressPaymentScale,\r\n            submitUserName,\r\n            submitDate,\r\n            state\r\n          }\r\n\r\n        }\r\n      } = this\r\n\r\n      const m = (val) => this.utils.formatMoney(val, 2, 0)\r\n      const d = (dataStr) => dataStr ? this.$moment(dataStr).format('YYYY-MM-DD') : dataStr\r\n      // const a = this.utils.amountInWords\r\n      const info = [\r\n        { label: '制单人', value: createUserName },\r\n        { label: '制单时间', value: createDate },\r\n        { label: '提交人', value: submitUserName },\r\n        { label: '提交时间', value: submitDate },\r\n        { label: '更新人', value: lastEditUserName },\r\n        { label: '更新时间', value: lastEditDate },\r\n        { label: '状态', value: this.filter.stateOptions.find(item => item.value === state).name }\r\n      ]\r\n      return [\r\n        { label: '合同编号', value: number },\r\n        { label: '合同名称', value: name },\r\n        { label: '合同类型', value: subcontractType },\r\n        { label: '是否用章', value: isSeal ? '是' : '否' },\r\n        { label: '项目', value: projectName },\r\n        { label: '组织机构', value: orgName },\r\n        { label: '分包单位', value: subcontractor },\r\n        { label: '法定代表人', value: corporation },\r\n        { label: '代理人', value: subcontractPeople },\r\n        { label: '乙方代表', value: secondParty },\r\n        { label: '合同开工日期', value: d(contractStartDate) },\r\n        { label: '合同竣工日期', value: d(contractFinishDate) },\r\n        { label: '合同工期', value: contractDuration },\r\n        { label: '合同额', value: m(contractAmount) },\r\n        { label: '开票税率', value: taxRate },\r\n        { label: '保修年限', value: repairYear },\r\n        { label: '进度款付款比例', value: progressPaymentScale },\r\n        { label: '结算上报比例', value: settleReportScale },\r\n        { label: '竣工验收比例', value: acceptenceScale },\r\n        { label: '结算付款比例', value: settlePaymentScale },\r\n        { label: '分包部位', value: subPart },\r\n        { label: '付款条款', value: paymentTerms },\r\n        { label: '备注', value: remark, monopolize: true },\r\n        // { label: '附件', value: upFile || [], component: 'UpFile' },\r\n        ...(state === 10000 ? info : [])\r\n      ]\r\n    }\r\n  },\r\n  beforeRouteEnter(to, from, next) {\r\n    next(vm => {\r\n      vm.initData()\r\n    })\r\n  },\r\n  methods: {\r\n    getFileList(key, def = []) {\r\n      const data = this.myDetails?.data\r\n      return data ? (data[key] || def) : def\r\n    },\r\n    // 作废\r\n    invalidForm() {\r\n      this.$confirm('作废以后将无法编辑，是否确定作废？', '提示', {\r\n        type: 'warning'\r\n      }).then(() => {\r\n        return DeleteSubcontractSignSet({ id: this.myId })\r\n      }).then(() => {\r\n        this.$message.success('操作成功')\r\n        this.back()\r\n      })\r\n    },\r\n    saveFlow() {\r\n      this.$confirm('是否确定保存？', '提示', {\r\n        type: 'warning'\r\n      }).then(() => {\r\n        const { showSaveStartButton, showSealStartButton } = this.myDetails\r\n        if (!this.fileList.length && (showSaveStartButton || showSealStartButton)) {\r\n          const type = showSealStartButton ? '用章附件' : '清单复印件'\r\n          return this.$message.error(`请上传${type}`)\r\n        }\r\n\r\n        let request = CheckSubcontractAssesment // 默认接口\r\n        if (showSealStartButton) { // 用章发起\r\n          request = SealSubcontractAssesment\r\n        } else if (showSaveStartButton) { // 存档\r\n          request = SaveSubcontractAssesment\r\n        }\r\n\r\n        this.saveLoading = true\r\n        const attitude = this.$refs.flowAttitude.getPostData()\r\n        request({ attitude, id: this.myDetails.data.id, fileList: this.fileList }).then(res => {\r\n          if (res.code === 200) {\r\n            this.$message.success(res.message)\r\n            this.goBack() // 跳转\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        }).finally(() => {\r\n          this.saveLoading = false\r\n        })\r\n      })\r\n    },\r\n    /**\r\n     * @description: 初始化数据\r\n     */\r\n    initData() {\r\n      const { id, type } = this.$route.query\r\n      this.type = type\r\n      this.myId = id\r\n      this.fetchData()\r\n    },\r\n    /**\r\n     * 提交审批意见以后的回调函数\r\n     */\r\n    updateFlow() {\r\n      // 直接返回\r\n      this.goBack()\r\n    },\r\n    /**\r\n     * 获取详情信息\r\n     */\r\n    async fetchData() {\r\n      if (!this.myId) return\r\n      GetSubcontractAssesmentAttitudeById({ id: this.myId }).then(res => {\r\n        this.billFlowData = res.billFlowData\r\n        this.filter.stateOptions = res.billFlowData?.form?.formState || []\r\n        this.myDetails = res\r\n        this.attitudePara = { formId: res.billFlowData.formId, billFlowId: res.data.billFlowId, planId: res.data.id }\r\n        // this.$nextTick(() => {\r\n        //   this.$refs['flowAttitude'].ruleForm.content = res.showPayButton ? '已支付' : ''\r\n        // })\r\n      }).catch(e => {\r\n        console.log('fetchData:请求列表数据失败，错误信息：', e)\r\n      })\r\n    },\r\n    /**\r\n     * 作废\r\n     */\r\n    // deleteIt() {\r\n    //   this.$confirm('作废以后将无法编辑和审批，是否确定作废？', '提示', {\r\n    //     type: 'warning'\r\n    //   }).then(() => {\r\n    //     return DeleteImprestAppliaction({ id: this.myId })\r\n    //   }).then((res) => {\r\n    //     this.$message.success(res.message)\r\n\r\n    //     this.utils.closeAndRefresh(this.$route.query.refreshRouterName)\r\n    //   }).catch(err => {\r\n    //     console.log(err)\r\n    //     // this.$message.error(err.errorMsg || '操作失败')\r\n    //   })\r\n    // },\r\n    goBack() {\r\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName)\r\n    }\r\n  }\r\n}\r\n",null]}