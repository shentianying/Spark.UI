{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\xmgl\\htly\\ProjectSettle\\details.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\xmgl\\htly\\ProjectSettle\\details.vue","mtime":1635749455712},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { GetProjectSettleAttitudeById, CheckProjectSettle } from '@/api/xmgl/ProjectSettle.js'\r\nimport FlowDisplay from '@/components/Flow/flowDisplay'\r\nimport FlowAttitude from '@/components/Flow/flowAttitude'\r\nimport Detailsedit from '@/components/Detailsedit'\r\nexport default {\r\n  name: 'ProjectSettleDetails',\r\n  components: {\r\n    // UpFile,\r\n    // AcceptanceCheckList,\r\n    FlowDisplay,\r\n    FlowAttitude,\r\n    Detailsedit\r\n  },\r\n  data() {\r\n    return {\r\n      size: 'mini',\r\n      activeNames: ['0', '1', '2'], // 展开的折叠面板\r\n      loading: false, // 请求未完成\r\n      myDetails: null, // 详情数据\r\n      billFlowData: null, // 流程信息\r\n      attitudePara: null // 审批信息\r\n    }\r\n  },\r\n  computed: {\r\n    /**\r\n     * 详情各字段计算\r\n     */\r\n    infoList() {\r\n      const {\r\n        myDetails: {\r\n          projectName,\r\n          orgName,\r\n          data: {\r\n            number,\r\n            settleDate,\r\n            settleAmount,\r\n            project,\r\n            receivableAccounts,\r\n            externalOutputs,\r\n            externalOutputAdjust,\r\n            internalOutputs,\r\n            internalOutputAdjust,\r\n            firstSupplyAmount,\r\n            IsReport,\r\n            remark,\r\n            upFile,\r\n            createUserName,\r\n            createDate,\r\n            lastEditUserName,\r\n            lastEditDate,\r\n            submitUserName,\r\n            submitDate\r\n          },\r\n          stateName\r\n        }\r\n      } = this\r\n      const m = (val) => this.utils.formatMoney(val, 2, 0)\r\n      const d = (dataStr) => dataStr ? this.$moment(dataStr).format('YYYY-MM-DD') : dataStr\r\n\r\n      return [\r\n        { label: '编号', value: number, monopolize: true },\r\n        { label: '项目', value: projectName },\r\n        { label: '组织机构', value: orgName },\r\n        { label: '审定日期', value: d(settleDate) },\r\n        // { label: '审定金额', value: m(settleAmount) },\r\n        { label: '审定值', value: m(settleAmount), unit: '元' },\r\n        { label: '建筑面积', value: `${project?.area || 0}㎡` },\r\n        { label: '合同工期', value: project?.contractDuration, unit: '天' },\r\n        { label: '甲供材', value: m(firstSupplyAmount) },\r\n        { label: '开累应收款', value: receivableAccounts },\r\n        { label: '开累外部产值', value: externalOutputs },\r\n        { label: '外部产值调整', value: externalOutputAdjust },\r\n        { label: '开累内部产值', value: internalOutputs },\r\n        { label: '内部产值调整', value: internalOutputAdjust },\r\n        { label: '报告', value: IsReport ? '有' : '无', monopolize: true },\r\n        { label: '备注', value: remark },\r\n        { label: '附件', value: upFile || [], component: 'UpFile', monopolize: true },\r\n\r\n        { label: '制单人', value: createUserName },\r\n        { label: '制单时间', value: createDate },\r\n        { label: '提交人', value: submitUserName },\r\n        { label: '提交时间', value: submitDate },\r\n        { label: '更新人', value: lastEditUserName },\r\n        { label: '更新时间', value: lastEditDate },\r\n        { label: '状态', value: stateName }\r\n      ]\r\n    },\r\n    /**\r\n     * 计算质保数组\r\n     */\r\n    warrantyList() {\r\n      const project = this.myDetails?.data?.project\r\n      const showList = []\r\n      const list = ['一', '二', '三', '四']\r\n      list.forEach((v, i) => {\r\n        showList.push({ label: `${v}阶段`, value: `${project?.[`warrantyRate${i + 1}`]}天` })\r\n        showList.push({ label: '比例', value: `${project?.[`warrantyDays${i + 1}`]}%` })\r\n      })\r\n      return showList\r\n    }\r\n  },\r\n  beforeRouteEnter(to, from, next) {\r\n    next(vm => {\r\n      vm.initDat()\r\n    })\r\n  },\r\n  methods: {\r\n    /**\r\n     * @description: 初始化数据\r\n     */\r\n    initDat() {\r\n      const { id } = this.$route.query\r\n      this.myId = id\r\n      this.fetchData()\r\n    },\r\n    /**\r\n     * 提交审批意见以后的回调函数\r\n     */\r\n    updateFlow() {\r\n      this.goBack()\r\n    },\r\n    /**\r\n     * 合同履约部分专有的提交审批\r\n     */\r\n    submitApproval() {\r\n      const result = this.$refs.flowAttitude.checkValidate()\r\n      if (result) {\r\n        var postData = this.$refs.flowAttitude.getPostData()\r\n        this.loading = true\r\n        CheckProjectSettle({ attitude: postData, id: this.myId }).then(({ message }) => {\r\n          this.$message.success(message)\r\n          this.updateFlow() // 跳转\r\n        }).finally(() => { this.loading = false })\r\n      }\r\n    },\r\n    /**\r\n     * 获取详情信息\r\n     */\r\n    async fetchData() {\r\n      if (!this.myId) return\r\n      this.loading = true\r\n      GetProjectSettleAttitudeById({ id: this.myId }).then(res => {\r\n        this.billFlowData = res.billFlowData\r\n        this.myDetails = res\r\n        this.attitudePara = { formId: res.billFlowData.formId, billFlowId: res.data.billFlowId, planId: res.data.id }\r\n      }).catch(e => {\r\n        console.log('fetchData:请求列表数据失败，错误信息：', e)\r\n      }).finally(() => {\r\n        this.loading = false\r\n      })\r\n    },\r\n    goBack() {\r\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName)\r\n    }\r\n  }\r\n}\r\n",null]}