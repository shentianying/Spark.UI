{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\rsgl\\gwc\\postPoolEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\rsgl\\gwc\\postPoolEdit.vue","mtime":1629185552571},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getPostPoolById, putPostPool, addPostPool, getPostPoolEditInit } from '@/api/rsgl/postPool'\r\nimport PostPoolDetailAdd from './postPoolDetailAdd'\r\nimport OrgSelect2 from '@/components/OrgSelect/index2'\r\n\r\nexport default {\r\n  name: 'PostPoolEdit',\r\n  components: {\r\n    PostPoolDetailAdd,\r\n    OrgSelect2\r\n  },\r\n  data() {\r\n    return {\r\n      ruleForm: {\r\n        id: 0,\r\n        name: '',\r\n        orgId: null,\r\n        category: '',\r\n        inUse: true\r\n      },\r\n      loading: false,\r\n      activate: false,\r\n      active: 0,\r\n      dialogTableVisible: false,\r\n      dialogTitle: '保存',\r\n      dialogWidth: '70%',\r\n      comName: 'PostPoolDetailAdd',\r\n      currentRow: null,\r\n      list: [],\r\n      categoryList: [],\r\n      postPoolId: null,\r\n      leaderList: null,\r\n      orgList: null,\r\n      rules: {\r\n        name: [{ required: true, message: '必填', trigger: 'blur' }],\r\n        category: [{ required: true, message: '请选择', trigger: 'blur' }]\r\n      }\r\n    }\r\n  },\r\n  activated() {\r\n    this.initData()\r\n    if (this.$route.params.id) {\r\n      this.refreshRouterName = this.$route.params.refreshRouterName\r\n    }\r\n  },\r\n  mounted() {\r\n    // getDictionaryList({ type: 'postPoolCategory' }).then(response => {\r\n    //   const { data } = response\r\n    //   this.categoryList = data\r\n    // })\r\n    // getPostPoolDetailList().then(response => {\r\n    //   const { data } = response\r\n    //   this.leaderList = data\r\n    // })\r\n    // getOrganizationList().then(response => {\r\n    //   const { data } = response\r\n    //   this.orgList = data\r\n    // })\r\n  },\r\n  methods: {\r\n    submitForm() {\r\n      this.$refs['ruleForm'].validate(valid => {\r\n        if (valid) {\r\n          if (this.ruleForm.category !== 1) {\r\n            this.ruleForm.orgId = 0\r\n          }\r\n          var newObj = JSON.parse(JSON.stringify(this.ruleForm))\r\n          var arrDetail = []\r\n          this.list.forEach(e => {\r\n            var p = {}\r\n            p.id = e.id\r\n            p.postId = e.postId\r\n            p.qualifications = e.qualifications\r\n            p.postDuty = e.postDuty\r\n            p.adminLeaderId = e.adminLeaderId\r\n            p.lineLeaderId = e.lineLeaderId\r\n            p.inUse = 1\r\n            p.roleId = e.roleId\r\n            arrDetail.push(p)\r\n          })\r\n          newObj.postPoolDetail = arrDetail\r\n          if (arrDetail.length < 1) {\r\n            this.$alert('请添加岗位！')\r\n            return\r\n          }\r\n          // console.log(newObj)\r\n          // 保存数据\r\n          this.loading = true\r\n          if (this.postPoolId) {\r\n            putPostPool(newObj).then(response => {\r\n              if (response.errorMsg) {\r\n                // 验证错误\r\n                this.$alert(`${response.errorMsg.replace(/；/g, '；<br />')}`,\r\n                  { dangerouslyUseHTMLString: true })\r\n                return\r\n              }\r\n              this.$message(response.message)\r\n              this.loading = false\r\n              this.closeThePage()\r\n            }).catch(() => { this.loading = false })\r\n          } else {\r\n            addPostPool(newObj).then(response => {\r\n              if (response.errorMsg) {\r\n                // 验证错误\r\n                this.$alert(`${response.errorMsg.replace(/；/g, '；<br />')}`,\r\n                  { dangerouslyUseHTMLString: true })\r\n                return\r\n              }\r\n              this.$message(response.message)\r\n              this.loading = false\r\n              this.closeThePage()\r\n            }).catch(() => { this.loading = false })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    initData() {\r\n      getPostPoolEditInit().then(response => {\r\n        const { data1, data2, data3 } = response\r\n        this.orgList = data2\r\n        this.categoryList = data1\r\n        this.leaderList = data3\r\n      })\r\n      // 有参数id 就是编辑\r\n      if (this.$route.query.id) {\r\n        this.postPoolId = this.$route.query.id\r\n      }\r\n      if (this.postPoolId) {\r\n        this.loading = true\r\n        getPostPoolById({ id: this.postPoolId }).then(response => this.setData(response))\r\n      }\r\n    },\r\n    setData(response) {\r\n      const { data } = response\r\n      var pom = []\r\n      data.postPoolDetail.forEach(e => {\r\n        pom.push({\r\n          id: e.id,\r\n          postId: e.postId,\r\n          post: {\r\n            id: e.post.id,\r\n            name: e.post.name\r\n          },\r\n          qualifications: e.qualifications,\r\n          postDuty: e.postDuty,\r\n          adminLeaderId: e.adminLeaderId,\r\n          lineLeaderId: e.lineLeaderId,\r\n          roleId: e.roleId\r\n        })\r\n      })\r\n      // 填充参数\r\n      this.ruleForm = data\r\n      // 填充 明细列表\r\n      this.list = pom\r\n      // console.log(data)\r\n      this.loading = false // loading 状态关闭\r\n    },\r\n    closeThePage() {\r\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName)\r\n    },\r\n    dialogClose(data, state) {\r\n      this.addPost(data, state)\r\n      // this.setColumnShow()\r\n      this.dialogTableVisible = false\r\n    },\r\n    addPost(data, state) {\r\n      if (data) {\r\n        if (state === 'add') {\r\n          this.list.push(data)\r\n        } else if (state === 'update') {\r\n          this.list.splice(this.listIndex, 1, data)\r\n        }\r\n      }\r\n    },\r\n    edit(d) {\r\n      this.currentRow = d.row\r\n      // console.log('edit=>d.row:', d.row)\r\n      this.listIndex = d.$index\r\n      this.dialogTitle = '编辑岗位'\r\n      this.comName = 'PostPoolDetailAdd'\r\n      this.dialogWidth = '70%'\r\n      this.dialogTableVisible = true\r\n    },\r\n    add() {\r\n      this.currentRow = null\r\n      this.dialogTitle = '添加岗位'\r\n      this.comName = 'PostPoolDetailAdd'\r\n      this.dialogWidth = '70%'\r\n      this.dialogTableVisible = true\r\n    },\r\n    del(d) {\r\n      // 页面删除\r\n      this.list.splice(d.$index, 1)\r\n    },\r\n    categoryChange(val) {\r\n      if (val === 1) {\r\n        this.ruleForm.name = ''\r\n      } else {\r\n        this.ruleForm.name = this.categoryList.find(f => f.value === val).name\r\n      }\r\n    },\r\n    orgChange(val) {\r\n      if (val) {\r\n        this.ruleForm.name = this.orgList.find(f => f.id === val).name\r\n      }\r\n    }\r\n  }\r\n}\r\n",null]}