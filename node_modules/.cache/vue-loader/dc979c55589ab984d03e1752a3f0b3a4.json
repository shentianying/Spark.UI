{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\fbgl\\fbdwgl\\SubcontractorAssesment\\details.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\fbgl\\fbdwgl\\SubcontractorAssesment\\details.vue","mtime":1635844823963},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Detailsedit from '@/components/Detailsedit'\r\nimport FlowDisplay from '@/components/Flow/flowDisplay'\r\nimport FlowAttitude from '@/components/Flow/flowAttitude'\r\nimport { GetSubcontractorAssesmentAttitudeById, CheckSubcontractorAssesment } from '@/api/fbgl/subcontractorAssesment'\r\nexport default {\r\n  name: 'SubcontractorAssesmentDetails',\r\n  components: {\r\n    Detailsedit,\r\n    FlowDisplay,\r\n    FlowAttitude\r\n  },\r\n  data() {\r\n    return {\r\n      size: 'mini',\r\n      showPayButton: false,\r\n      labelWidth: 140,\r\n      type: 'approval', // 审核:approval 详情:details 支付:pay 变更:alteration 回收:recycle, reviewStar: 评审星级\r\n      saveLoading: false,\r\n      myDetails: null, // 详情数据\r\n      billFlowData: null, // 流程信息\r\n      attitudePara: null // 审批信息\r\n    }\r\n  },\r\n  computed: {\r\n    infoList() {\r\n      const {\r\n        myDetails: {\r\n          data: {\r\n            number,\r\n            orgStr,\r\n            name,\r\n            subcontractorType,\r\n            address,\r\n            postAddress,\r\n            capital,\r\n            mainBusiness,\r\n            corporation,\r\n            entrustedAgent,\r\n            phone,\r\n            tel,\r\n            fax,\r\n            email,\r\n            regDate,\r\n            taxpayerType,\r\n            workerNum,\r\n            isForbidden,\r\n            bussinessType,\r\n            projectType,\r\n            businessCity,\r\n            postCertificate,\r\n            remark,\r\n            createDate,\r\n            createUserName,\r\n            currentRateDate,\r\n            lastEditUserName,\r\n            lastEditDate,\r\n            rate,\r\n            licenseUpFile,\r\n            licenseStart,\r\n            licenseEnd,\r\n            accountUpFile,\r\n            corporationUpFile,\r\n            infoUpFile,\r\n            deliveryStatementUpFile,\r\n            taxpayerCerUpFile,\r\n            qualificationUpFile,\r\n            qualificationNum,\r\n            regScopeStart,\r\n            regScopeEnd,\r\n            safetyUpFile,\r\n            safetyCerNum,\r\n            safetyPeriodStart,\r\n            safetyPeriodEnd,\r\n            financeReportUpFile,\r\n            upFile\r\n          }\r\n        }\r\n      } = this\r\n      // 数据格式化\r\n      const m = (val) => this.utils.formatMoney(val, 2, 0)\r\n      const d = (dataStr) => dataStr ? this.$moment(dataStr).format('YYYY-MM-DD') : dataStr\r\n      return [\r\n        { label: '编号', value: number },\r\n        { label: '部门', value: orgStr },\r\n        { label: '单位名称', value: name },\r\n        { label: '分包类型', value: subcontractorType },\r\n        { label: '注册地址', value: address },\r\n        { label: '邮寄地址', value: postAddress },\r\n        { label: '注册资本', value: m(capital), unit: '万元' },\r\n        { label: '经营范围', value: mainBusiness },\r\n        { label: '法定代表人', value: corporation },\r\n        { label: '委托代理人', value: entrustedAgent },\r\n        { label: '手机', value: phone },\r\n        { label: '固话', value: tel },\r\n        { label: '传真', value: fax },\r\n        { label: '邮箱', value: email },\r\n        { label: '成立日期', value: d(regDate) },\r\n        { label: '纳税人性质', value: taxpayerType },\r\n        { label: '工人数量', value: workerNum },\r\n        { label: '是否禁用', value: isForbidden ? '是' : '否' },\r\n        { label: '可承接业务类型', value: bussinessType.join('、') },\r\n        { label: '可承接工程类型', value: projectType.join('、') },\r\n        { label: '可施工区域', monopolize: true, value: businessCity.join('、') },\r\n        { label: '上岗证书', value: postCertificate },\r\n        { label: '备注', value: remark },\r\n        { label: '制单人', value: createUserName },\r\n        { label: '制单时间', value: createDate },\r\n        { label: '更新人', value: lastEditUserName },\r\n        { label: '更新时间', value: lastEditDate },\r\n        { label: '星级', value: rate },\r\n        { label: '评审时间', value: currentRateDate },\r\n        { label: '营业执照', monopolize: true, component: 'UpFile', value: licenseUpFile },\r\n        { label: '营业期限', monopolize: true, value: `${d(licenseStart)} 至 ${d(licenseEnd)}` },\r\n        { label: '开户许可证', monopolize: true, component: 'UpFile', value: accountUpFile },\r\n        { label: '法定代表人身份证明', monopolize: true, component: 'UpFile', value: corporationUpFile },\r\n        { label: '分包考察资料', monopolize: true, component: 'UpFile', value: infoUpFile },\r\n        { label: '送达声明', monopolize: true, component: 'UpFile', value: deliveryStatementUpFile },\r\n        { label: '纳税人信息证明', monopolize: true, component: 'UpFile', value: taxpayerCerUpFile },\r\n        { label: '施工资质证书  ', monopolize: true, component: 'UpFile', value: qualificationUpFile },\r\n        { label: '编号', value: qualificationNum },\r\n        { label: '登记范围', value: `${regScopeStart}${regScopeEnd}` },\r\n        { label: '安全生产许可证', monopolize: true, component: 'UpFile', value: safetyUpFile },\r\n        { label: '编号', value: safetyCerNum },\r\n        { label: '有效期', value: `${d(safetyPeriodStart) || ''} 至 ${d(safetyPeriodEnd) || ''}` },\r\n        { label: '财务审计报告', monopolize: true, component: 'UpFile', value: financeReportUpFile },\r\n        { label: '其他附件', monopolize: true, component: 'UpFile', value: upFile }\r\n      ]\r\n    }\r\n  },\r\n  beforeRouteEnter(to, from, next) {\r\n    next(vm => {\r\n      vm.initData()\r\n    })\r\n  },\r\n  methods: {\r\n    /**\r\n     * @description: 初始化数据\r\n     */\r\n    initData() {\r\n      const { id, type } = this.$route.query\r\n      this.myId = id\r\n      this.type = type\r\n      this.fetchData()\r\n    },\r\n    async fetchData() {\r\n      if (!this.myId) return\r\n      GetSubcontractorAssesmentAttitudeById({ id: this.myId }).then(res => {\r\n        this.myDetails = res\r\n        this.billFlowData = res.billFlowData\r\n        this.attitudePara = { formId: res.billFlowData.formId, billFlowId: res.billFlowData.id, planId: res.data.id }\r\n      })\r\n    },\r\n    saveFlow() {\r\n      this.$confirm('是否确定保存？', '提示', {\r\n        type: 'warning'\r\n      }).then(() => {\r\n        this.saveLoading = true\r\n        const attitude = this.$refs.flowAttitude.getPostData()\r\n        CheckSubcontractorAssesment({ attitude, entertainmentPlan: this.entertainmentPlan }).then(res => {\r\n          if (res.code === 200) {\r\n            this.$message.success(res.message)\r\n            this.goBack() // 跳转\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        }).finally(() => {\r\n          this.saveLoading = false\r\n        }).catch(() => {\r\n          this.saveLoading = false\r\n        })\r\n      })\r\n    },\r\n    /**\r\n     * 提交审批意见以后的回调函数\r\n     */\r\n    updateFlow() {\r\n      // 直接返回\r\n      this.goBack()\r\n    },\r\n    goBack() {\r\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName)\r\n    }\r\n  }\r\n}\r\n",null]}