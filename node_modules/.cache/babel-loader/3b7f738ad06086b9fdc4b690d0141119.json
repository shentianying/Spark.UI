{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js!D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\cggl\\supplier\\supplierAdd.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\cggl\\supplier\\supplierAdd.vue","mtime":1634288659611},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _supplier = require(\"@/api/cggl/supplier\");\n\nvar _index = _interopRequireDefault(require(\"@/components/OrgSelect/index2\"));\n\nvar _UpFile = _interopRequireDefault(require(\"@/components/UpLoad/UpFile\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'SupplierAdd',\n  components: {\n    UpFile: _UpFile.default,\n    OrgSelect2: _index.default\n  },\n  data: function data() {\n    return {\n      ruleForm: {\n        number: '',\n        name: '',\n        oldName: '',\n        address: '',\n        city: null,\n        email: '',\n        url: '',\n        corporation: '',\n        capital: null,\n        companyPhone: '',\n        contacts: '',\n        contactsPhone: '',\n        bankName: '',\n        bankAccount: '',\n        rate: 0,\n        mainBusiness: '',\n        businessCity: null,\n        remark: '',\n        inUse: true,\n        state: 0\n      },\n      fileList: [],\n      supplierId: null,\n      buttonLoading: false,\n      treeData: null,\n      orgValue: null,\n      rules: {\n        name: [{\n          required: true,\n          message: '必填',\n          trigger: 'blur'\n        }],\n        mainBusiness: [{\n          required: true,\n          message: '必填',\n          trigger: 'blur'\n        }],\n        businessCity: [{\n          required: true,\n          message: '必填',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  mounted: function mounted() {},\n  activated: function activated() {\n    this.initData();\n\n    if (this.$route.params.id) {\n      this.refreshRouterName = this.$route.params.refreshRouterName;\n    }\n  },\n  methods: {\n    submitForm: function submitForm(formName) {\n      var _this = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var newObj = JSON.parse(JSON.stringify(_this.ruleForm));\n          newObj.businessCity = newObj.businessCity ? newObj.businessCity.join() : '';\n          var tempIds = [];\n\n          if (_this.fileList.length) {\n            tempIds = _this.fileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          var postData = {\n            supplier: newObj,\n            fileList: tempIds\n          };\n\n          if (_this.supplierId) {\n            // 修改\n            _this.buttonLoading = true;\n            (0, _supplier.putSupplier)(postData).then(function (response) {\n              _this.$message(response.message);\n\n              _this.buttonLoading = false;\n\n              _this.closeThePage(); // this.$emit('dialogClose')\n\n            }).catch(function () {\n              _this.buttonLoading = false;\n            });\n          } else {\n            // 添加\n            _this.buttonLoading = true;\n            (0, _supplier.addSupplier)(postData).then(function (response) {\n              _this.$message(response.message);\n\n              _this.buttonLoading = false;\n\n              _this.closeThePage(); // this.$emit('dialogClose')\n\n            }).catch(function () {\n              _this.buttonLoading = false;\n            });\n          }\n        }\n      });\n    },\n    initData: function initData() {\n      var _this2 = this;\n\n      new Promise(function (resolve, reject) {\n        (0, _supplier.getSupplierEditInit)().then(function (response) {\n          var data = response.data;\n          data.forEach(function (element) {\n            element.label = element.name;\n          });\n          resolve(data);\n        });\n      }).then(function (treeData) {\n        _this2.supplierId = _this2.$route.query.id;\n\n        if (_this2.supplierId) {\n          (0, _supplier.getSupplierById)({\n            id: _this2.supplierId\n          }).then(function (response) {\n            var data = response.data,\n                files = response.files;\n            data.businessCity = data.businessCity.split(',').map(function (m) {\n              return Number(m);\n            });\n            _this2.treeData = treeData;\n            _this2.ruleForm = data;\n            _this2.fileList = files; // 附件\n          });\n        } else {\n          _this2.ruleForm.city = null;\n          _this2.treeData = treeData;\n        }\n      }).catch(function () {\n        _this2.$message.error('信息错误');\n      });\n    },\n    closeThePage: function closeThePage() {\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName);\n    },\n    attitude: function attitude(id, type) {\n      this.closeThePage();\n      this.$router.push({\n        name: 'SupplierAssesmentEdit',\n        query: {\n          id: id,\n          refreshRouterName: this.$route.name\n        },\n        params: {\n          id: id,\n          type: type\n        }\n      });\n    }\n  }\n};\nexports.default = _default;",null]}