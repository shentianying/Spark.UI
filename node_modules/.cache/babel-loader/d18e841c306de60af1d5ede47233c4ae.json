{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js!D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\components\\Flow\\flowDisplayAdd.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\components\\Flow\\flowDisplayAdd.vue","mtime":1624071363284},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.array.find-index\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/toConsumableArray\"));\n\nrequire(\"core-js/modules/es6.array.sort\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _billFlowNodeReviewerAdd = _interopRequireDefault(require(\"./billFlowNodeReviewerAdd\"));\n\nvar _billFlow = require(\"@/api/xtgl/billFlow\");\n\nvar _index = require(\"@/utils/index\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// 查看流程进度\nvar _default = {\n  name: 'FlowDisplayAdd1',\n  components: {\n    BillFlowNodeReviewerAdd: _billFlowNodeReviewerAdd.default\n  },\n  props: {\n    billFlow: {\n      type: Object,\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      stateList: [],\n      loading: false,\n      createUserName: '',\n      billFlowData: null,\n      dialogTableVisible: false,\n      dialogTitle: '保存',\n      dialogWidth: '50%',\n      comName: 'BillFlowNodeReviewerAdd',\n      state: null,\n      group: null,\n      mode: null,\n      // index: null,\n      // index1: null,\n      // addType: 0, // 0:同一个group 中添加 1：2个group 之间添加 2：2个formState 之间添加，3：最后的formState 添加\n      isCurrentState: false,\n      temp: {\n        keyId: null,\n        // 添加流程节点，页面上的唯一标识\n        billFlowId: 0,\n        // checkupDate: null,\n        // checkupPersonId: null,\n        //   createDate: null,\n        createUserId: null,\n        //   createUserName: null,\n        group: 100,\n        id: 0,\n        isAutoChecked: false,\n        isChecked: false,\n        isCurrentState: false,\n        isFixedNode: true,\n        maxDays: 0,\n        mode: 1,\n        nodeType: 1,\n        // 1 新增节点\n        option: 0,\n        orgId: 0,\n        // ?\n        person: null,\n        personId: null,\n        personList: null,\n        receiveDate: null,\n        remark: null,\n        //   role: null,\n        roleId: 0,\n        roleType: 3,\n        state: 1 //  userList: []\n\n      }\n    };\n  },\n  computed: {\n    getUid: function getUid() {\n      return this.$store.state.user.info.uid;\n    }\n  },\n  created: function created() {},\n  mounted: function mounted() {\n    this.billFlowData = JSON.parse(JSON.stringify(this.billFlow));\n    this.fetchData();\n  },\n  methods: {\n    fetchData: function fetchData() {\n      var _this = this;\n\n      this.createUserName = this.billFlowData.createUserName;\n      this.billFlowData.billFlowNode.forEach(function (fe) {\n        fe.personId = fe.personId || null;\n      });\n      this.billFlowData.form.formState.forEach(function (e, i) {\n        if (e.isFlowNode) {\n          if (e.isCheckup) {\n            e.stateNode = _this.groupBy(_this.billFlowData.billFlowNode.filter(function (f) {\n              return f.state === e.value;\n            }), function (item) {\n              return [item.group];\n            });\n          }\n\n          _this.stateList.push(e);\n        }\n      });\n    },\n    groupBy: function groupBy(array, f) {\n      var groups = {};\n      array.forEach(function (o) {\n        var group = JSON.stringify(f(o));\n        groups[group] = groups[group] || [];\n        groups[group].push(o);\n      });\n      return Object.keys(groups).map(function (group) {\n        return groups[group];\n      });\n    },\n    addChecker: function addChecker(item1, index, index1) {\n      this.group = item1[0].group;\n      this.state = item1[0].state;\n      this.isCurrentState = item1[0].isCurrentState;\n      this.mode = item1[0].mode; // this.index = index\n      // this.index1 = index1\n      // this.addType = 0\n\n      this.dialogTitle = '添加审核人';\n      this.dialogTableVisible = true;\n    },\n    // 添加完成关闭后执行的\n    dialogClose1: function dialogClose1(bf) {\n      var temp = JSON.parse(JSON.stringify(this.temp)); // 设置group\n\n      temp.keyId = _index.uuid;\n      temp.createUserId = this.getUid;\n      temp.group = this.group;\n      temp.state = this.state;\n      temp.personId = bf.id;\n      temp.person = bf;\n      temp.mode = this.mode;\n      temp.billFlowId = this.billFlow.id;\n      temp.isCurrentState = this.isCurrentState;\n      var sameGroup = this.billFlowData.billFlowNode.filter(function (f) {\n        return f.state === temp.state && f.group === temp.group;\n      });\n\n      if (sameGroup) {\n        var haveSameGroupNode = sameGroup.map(function (m) {\n          return m.personId;\n        }).includes(temp.personId);\n\n        if (haveSameGroupNode) {\n          this.$message('同一个组中，不能添加相同的审核人');\n          return;\n        }\n      }\n\n      this.billFlowData.billFlowNode.push(temp);\n      this.billFlowData.billFlowNode.sort(function (a, b) {\n        return a.group - b.group;\n      });\n      this.stateList = [];\n      this.dialogTableVisible = false;\n      this.fetchData();\n    },\n    addBillFlowNode: function addBillFlowNode(item, index1) {\n      // console.log('addBillFlowNode')\n      var group1 = item[index1][0].group; // 小 例如：group:200\n\n      var group2 = item[index1 + 1][0].group; // 大 例如：group:210\n\n      this.group = (group2 + group1) / 2; // 中间值：205\n\n      this.state = item[index1 + 1][0].state;\n      this.mode = item[index1 + 1][0].mode; // this.index = index\n      // this.index1 = index1\n      // this.addType = 1\n      // console.log('index:', index)\n      // console.log('index1:', index1)\n\n      this.dialogTitle = '添加审核人';\n      this.dialogTableVisible = true;\n    },\n    addBillFlowNode2: function addBillFlowNode2(item, index) {\n      // console.log('addBillFlowNode2')\n      // console.log('this.stateList:', this.stateList)\n      // console.log('item:', item)\n      // console.log('index:', index)\n      if (index === 0) {\n        this.$alert('此位置不允许添加节点');\n        return;\n      } // 获取是审核表单状态的 formState\n\n\n      var filterFormState = this.stateList.filter(function (f) {\n        return f.inUse && f.isCheckup && f.isFlowNode && f.stateNode.length > 0;\n      }); // 当前审批节点\n\n      var currentFormState = this.billFlowData.billFlowNode.filter(function (f) {\n        return f.isCurrentState;\n      });\n\n      if (!currentFormState) {\n        this.$alert('数据异常，流程中没有当前审批节点');\n        return;\n      }\n\n      if (index < filterFormState.length) {\n        // 点击2个审核节点之间的箭头\n        var formState_A = (0, _toConsumableArray2.default)(filterFormState[index - 1].stateNode).reverse()[0][0];\n        var formState_B = filterFormState[index].stateNode[0][0];\n        var smallGroup = formState_A.group; // 200\n\n        var largeGroup = formState_B.group; // 300\n\n        var calGroup = (largeGroup + smallGroup) / 2; // 250\n\n        if (currentFormState[0] > calGroup) {\n          this.$alert('当前审批节点前面不允许添加审批人');\n          return;\n        }\n\n        this.group = calGroup;\n        this.state = formState_B.state;\n        this.mode = formState_B.mode;\n      } else if (index === filterFormState.length) {\n        // 点击的是最后一个箭头\n        if (item.stateNode.length > 0) {\n          var lastFormState = (0, _toConsumableArray2.default)(filterFormState[index - 1].stateNode).reverse()[0][0];\n          this.group = lastFormState.group + 100;\n          this.state = lastFormState.state;\n          this.mode = lastFormState.mode;\n        }\n      }\n\n      if (item.stateNode.length > 0) {\n        this.dialogTitle = '添加审核人';\n        this.dialogTableVisible = true;\n      }\n    },\n    save: function save() {\n      var _this2 = this;\n\n      var bfn = JSON.parse(JSON.stringify(this.billFlowData.billFlowNode)); // const arr = bfn.filter(f => f.id === 0)\n      // if (arr) {\n\n      bfn.forEach(function (e) {\n        delete e.person;\n        delete e.personList;\n        delete e.keyId;\n        e.remark = '编辑时添加';\n      });\n      this.$confirm('是否确定修改该流程', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this2.loading = true;\n        (0, _billFlow.addBillFlowNodes)(bfn).then(function (res) {\n          var data = res.data,\n              message = res.message;\n          _this2.loading = false;\n\n          _this2.$emit('dialogClose', data);\n\n          _this2.$message.success(message);\n        }).catch(function () {\n          _this2.loading = false;\n        });\n      }).catch(function () {}); // }\n    },\n    delBillFlowNode: function delBillFlowNode(item2) {\n      if (item2.isChecked) {\n        this.$message('审批过的不能删除哦！');\n        return;\n      }\n\n      if (item2.nodeType === 0) {\n        this.$message('只有手动创建的才能删除');\n        return;\n      }\n\n      if (item2.createUserId !== this.getUid) {\n        this.$message('不是创建人，无法删除哦');\n        return;\n      } // console.log('item2:', item2)\n\n\n      if (item2.id > 0) {\n        // 从数据库获取的数据\n        var fI = this.billFlowData.billFlowNode.findIndex(function (f) {\n          return f.id === item2.id;\n        });\n        this.billFlowData.billFlowNode.splice(fI, 1);\n      } else {\n        this.billFlowData.billFlowNode.splice(this.billFlowData.billFlowNode.findIndex(function (f) {\n          return f.keyId === item2.keyId;\n        }), 1);\n      }\n\n      this.billFlowData.billFlowNode.sort(function (a, b) {\n        return a.group - b.group;\n      });\n      this.stateList = [];\n      this.fetchData(); // console.log('删除后的对象stateList：', this.stateList)\n    }\n  }\n};\nexports.default = _default;",null]}