{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js!D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\ywgl\\bussiness\\bussinessInfoEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\ywgl\\bussiness\\bussinessInfoEdit.vue","mtime":1635986769250},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _customer = require(\"@/api/ywgl/customer\");\n\nvar _bussinessInfo = require(\"@/api/ywgl/bussinessInfo\");\n\nvar _index = _interopRequireDefault(require(\"@/components/OrgSelect/index2\"));\n\nvar _selectPerson = _interopRequireDefault(require(\"@/components/Other/selectPerson\"));\n\nvar _UpFile = _interopRequireDefault(require(\"@/components/UpLoad/UpFile\"));\n\nvar _selectCustomer = _interopRequireDefault(require(\"@/components/Other/ywgl/selectCustomer\"));\n\nvar _utils = require(\"@/utils\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// import { validate } from '@/utils/validate'\nvar _default = {\n  name: 'BussinessInfoEdit',\n  components: {\n    OrgSelect2: _index.default,\n    UpFile: _UpFile.default,\n    SelectPerson: _selectPerson.default,\n    SelectCustomer: _selectCustomer.default\n  },\n  data: function data() {\n    return {\n      ruleForm: {\n        orgId: null,\n        companyId: this.$store.state.user.selectOrgId,\n        professionalType: null,\n        informationSource: null,\n        area: null,\n        progress: null,\n        marketCategory: null,\n        cooperationMode: null,\n        projectName: '',\n        isDirectEntrust: false,\n        generalContractor: '',\n        builder: '',\n        projectSurvey: '',\n        developer: null,\n        linkMan: '',\n        intermediary: '',\n        intermediaryTel: '',\n        address: '',\n        houseProperty: null,\n        floors: '',\n        buildingStructure: '',\n        decorationArea: null,\n        totalArea: null,\n        cost: null,\n        paymentTerms: '',\n        tenderMode: null,\n        tenderEndDate: '',\n        startDate: '',\n        finishDate: '',\n        currentStatus: '',\n        currentStatusDate: '',\n        dockPerson: null,\n        trackDepth: null,\n        marketingManager: null,\n        marketingMemberNames: '',\n        marketingMember: null,\n        trackPerson: this.$store.state.user.uid,\n        tenderSections: null,\n        competitors: '',\n        remark: '',\n        isComplete: false,\n        state: 0,\n        formState: 0,\n        billFlowId: 0,\n        organization: null,\n        zxdcbFileList: [],\n        dblcFileList: [],\n        zrsFileList: [],\n        chsFileList: [],\n        zzjgFileList: [],\n        qtFileList: []\n      },\n      keyOrg: 0,\n      orgList: null,\n      areaList: [],\n      cooperationModeList: [],\n      // 合作模式\n      marketCategoryList: [],\n      professionalTypeList: [],\n      progressList: [],\n      tenderModeList: [],\n      trackDepthList: [],\n      informationSourceList: [],\n      housePropertyList: [],\n      developerList: [],\n      personList: [],\n      dockPersonList: [],\n      bussinessInfoId: null,\n      keyInformationSource: 0,\n      keyHouseProperty: 0,\n      trackPersonName: this.$store.state.user.name,\n      managerName: '',\n      developer: '',\n      buttonLoading: false,\n      refreshRouterName: '',\n      rules: {\n        projectName: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        generalContractor: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        developer: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }],\n        orgId: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        tenderMode: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }],\n        progress: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }],\n        trackDepth: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }],\n        informationSource: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        houseProperty: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        cooperationMode: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }],\n        currentStatusDate: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }],\n        linkMan: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        floors: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        buildingStructure: [{\n          required: true,\n          message: '不能为空',\n          trigger: 'blur'\n        }],\n        marketingManager: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }],\n        trackPerson: [{\n          required: true,\n          message: '不能为空',\n          trigger: ['blur', 'change']\n        }] // decorationArea: [{ validator: validate.dbl, required: true, message: '可为空或数字类型', trigger: 'blur' }],\n        // totalArea: [{ validator: validate.dbl, required: false, message: '可为空或数字类型', trigger: 'blur' }],\n        // cost: [{ validator: validate.dbl, required: false, message: '可为空或数字类型', trigger: 'blur' }],\n        // intermediaryTel: [{ validator: validate.phone, required: false, message: '电话或手机号不正确', trigger: 'blur' }]\n\n      }\n    };\n  },\n  mounted: function mounted() {},\n  activated: function activated() {\n    if (this.$route.query.id) {\n      this.bussinessInfoId = this.$route.query.id;\n      this.refreshRouterName = this.$route.params.refreshRouterName;\n    }\n\n    console.log();\n    this.initData();\n  },\n  methods: {\n    submitForm: function submitForm(state) {\n      var _this = this;\n\n      this.$refs['ruleForm'].validate(function (valid) {\n        if (valid) {\n          var postData = JSON.parse(JSON.stringify(_this.ruleForm));\n          postData.dockPerson = postData.dockPerson ? postData.dockPerson.join() : '';\n          var tempIds = [];\n\n          if (postData.zxdcbFileList.length > 0) {\n            tempIds = postData.zxdcbFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          postData.zxdcbFileList = tempIds;\n          tempIds = [];\n\n          if (postData.dblcFileList.length > 0) {\n            tempIds = postData.dblcFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          postData.dblcFileList = tempIds;\n          tempIds = [];\n\n          if (postData.zrsFileList.length > 0) {\n            tempIds = postData.zrsFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          postData.zrsFileList = tempIds;\n          tempIds = [];\n\n          if (postData.chsFileList.length > 0) {\n            tempIds = postData.chsFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          postData.chsFileList = tempIds;\n          tempIds = [];\n\n          if (postData.zzjgFileList.length > 0) {\n            tempIds = postData.zzjgFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          postData.zzjgFileList = tempIds;\n          tempIds = [];\n\n          if (postData.qtFileList.length > 0) {\n            tempIds = postData.qtFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          postData.qtFileList = tempIds;\n          console.log(postData);\n\n          if (_this.bussinessInfoId) {\n            _this.buttonLoading = true;\n            (0, _bussinessInfo.putBussinessInfo)(postData).then(function (response) {\n              if (response.errorMsg) {\n                // 验证错误\n                _this.$alert(\"\".concat(response.errorMsg.replace(/；/g, '；<br />')), {\n                  dangerouslyUseHTMLString: true\n                });\n\n                return;\n              }\n\n              _this.$message(response.message);\n\n              _this.buttonLoading = false;\n\n              _this.closeThePage();\n            }).catch(function () {\n              _this.buttonLoading = false;\n            });\n          } else {\n            _this.buttonLoading = true;\n            (0, _bussinessInfo.addBussinessInfo)(postData).then(function (response) {\n              if (response.errorMsg) {\n                // 验证错误\n                _this.$alert(\"\".concat(response.errorMsg.replace(/；/g, '；<br />')), {\n                  dangerouslyUseHTMLString: true\n                });\n\n                return;\n              }\n\n              _this.$message(response.message);\n\n              _this.buttonLoading = false;\n\n              _this.closeThePage();\n            }).catch(function () {\n              _this.buttonLoading = false;\n            });\n          }\n        }\n      });\n    },\n    initData: function initData() {\n      var _this2 = this;\n\n      new Promise(function (resolve, reject) {\n        (0, _bussinessInfo.getBussinessInfoEditInit)().then(function (response) {\n          var data = response.data,\n              orgList = response.orgList,\n              result1 = response.result1,\n              result2 = response.result2,\n              result3 = response.result3,\n              result4 = response.result4,\n              result5 = response.result5,\n              result6 = response.result6,\n              result7 = response.result7,\n              result8 = response.result8,\n              result9 = response.result9,\n              result10 = response.result10,\n              result11 = response.result11;\n          _this2.orgList = orgList;\n          _this2.cooperationModeList = result1;\n          _this2.marketCategoryList = result2;\n          _this2.professionalTypeList = result3;\n          _this2.progressList = result4;\n          _this2.tenderModeList = result5;\n          _this2.trackDepthList = result6;\n          result7.forEach(function (element) {\n            element.pid = element.pId;\n            element.label = element.name;\n          });\n          _this2.informationSourceList = (0, _utils.getTree)(0, result7);\n          result8.forEach(function (element) {\n            element.pid = element.pId;\n            element.label = element.name;\n          });\n          _this2.housePropertyList = (0, _utils.getTree)(0, result8);\n          _this2.developerList = result9;\n          _this2.personList = result10;\n          _this2.dockPersonList = result11;\n          data.forEach(function (element) {\n            element.label = element.name;\n          });\n          resolve(data);\n        });\n      }).then(function (treeData) {\n        if (_this2.bussinessInfoId) {\n          (0, _bussinessInfo.getBussinessInfoWithAttitudeById)({\n            id: _this2.bussinessInfoId\n          }).then(function (response) {\n            var data = response.data;\n            data.dockPerson = data.dockPerson !== '' ? data.dockPerson.split(',').map(function (item) {\n              return Number(item);\n            }) : null; // data.marketingMember = data.marketingMember.split(',').map(item => Number(item))\n\n            _this2.areaList = treeData;\n            _this2.ruleForm = data;\n            _this2.trackPersonName = data.person.name;\n            _this2.managerName = data.manager.name;\n            _this2.developer = data.customer.name;\n            _this2.keyOrg += 1;\n            _this2.ruleForm.zxdcbFileList = data.zxdcbUpFile;\n            _this2.ruleForm.dblcFileList = data.dblcUpFile;\n            _this2.ruleForm.zrsFileList = data.zrsUpFile;\n            _this2.ruleForm.chsFileList = data.chsUpFile;\n            _this2.ruleForm.zzjgFileList = data.zzjgUpFile;\n            _this2.ruleForm.qtFileList = data.qtUpFile;\n          });\n        } else {\n          _this2.areaList = treeData;\n        }\n      }).catch(function () {\n        _this2.$message.error('信息错误');\n      });\n    },\n    cancel: function cancel() {},\n    closeThePage: function closeThePage() {\n      if (this.$route.query.refreshRouterName === 'BussinessInfoReply') {\n        this.$store.dispatch('tagsView/delView', this.$route);\n        this.$router.push({\n          name: 'BussinessInfoReply',\n          query: {\n            id: this.bussinessInfoId,\n            refreshRouterName: 'BussinessInfo'\n          },\n          params: {\n            id: this.bussinessInfoId\n          }\n        });\n      } else {\n        this.utils.closeAndRefresh(this.$route.query.refreshRouterName);\n      }\n    },\n    getLinkMan: function getLinkMan() {\n      var _this3 = this;\n\n      (0, _customer.getCustomerById)({\n        id: this.ruleForm.developer\n      }).then(function (response) {\n        var data = response.data;\n        _this3.ruleForm.linkMan = data.linkMan;\n      });\n    },\n    selectTrackPerson: function selectTrackPerson() {\n      this.$refs.trackPersonRef.openDialog();\n    },\n    getTrackPerson: function getTrackPerson(persons) {\n      if (persons.length > 0) {\n        this.ruleForm.trackPerson = persons[0].id;\n        this.trackPersonName = persons[0].name;\n      }\n    },\n    selectMember: function selectMember() {\n      this.$refs.memberRef.openDialog();\n    },\n    getMember: function getMember(persons) {\n      if (persons.length > 0) {\n        this.ruleForm.marketingMember = persons.map(function (m) {\n          return m.id;\n        }).join(',');\n        this.ruleForm.marketingMemberNames = persons.map(function (m) {\n          return m.name;\n        }).join(',');\n      }\n    },\n    selectManager: function selectManager() {\n      this.$refs.managerRef.openDialog();\n    },\n    getManager: function getManager(persons) {\n      if (persons.length > 0) {\n        this.ruleForm.marketingManager = persons[0].id;\n        this.managerName = persons[0].name;\n      }\n    },\n    selectCustomer: function selectCustomer() {\n      this.$refs.customerRef.openDialog();\n    },\n    getCustomer: function getCustomer(data) {\n      if (data.length > 0) {\n        this.ruleForm.developer = data[0].id;\n        this.developer = data[0].name;\n        this.ruleForm.linkMan = data[0].linkMan;\n      }\n    }\n  }\n};\nexports.default = _default;",null]}