{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js!D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\cwgl\\zjgl\\Expend\\edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\cwgl\\zjgl\\Expend\\edit.vue","mtime":1631087446331},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _Expend = require(\"@/api/cwgl/zjgl/Expend.js\");\n\nvar _OrgSelect = _interopRequireDefault(require(\"@/components/SearchBar/OrgSelect\"));\n\nvar _PersonSelect = _interopRequireDefault(require(\"@/components/SearchBar/PersonSelect2\"));\n\nvar _CapitalSelect = _interopRequireDefault(require(\"@/components/SearchBar/CapitalSelect\"));\n\nvar _AcceptanceCheckList = _interopRequireDefault(require(\"@/components/Other/AcceptanceCheckList\"));\n\nvar _validate = require(\"@/utils/validate\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// 部门选择器\n// 选人组件\n// 资金类型选择器\n// 未支出承兑单弹窗\nvar _default = {\n  // 组件名称\n  name: 'ZiJinZhiChuEdit',\n  // 局部注册的组件\n  components: {\n    OrgSelect: _OrgSelect.default,\n    PersonSelect: _PersonSelect.default,\n    CapitalSelect: _CapitalSelect.default,\n    AcceptanceCheckList: _AcceptanceCheckList.default\n  },\n  // 组件状态值\n  data: function data() {\n    return {\n      type: 'add',\n      // 编辑:edit  新增:add\n      size: 'mini',\n      // 整体大小\n      dialogVisible: false,\n      // 控制对话框显示\n      isCanUpdate: true,\n      // 是否可编辑,备注银行除外\n      zcForm: {\n        id: '',\n        expendDate: '',\n        // 支出日期\n        number: '',\n        // 收款编号\n        orgId: '',\n        // 部门\n        expendType: '',\n        // 支出类型\n        capitalType: '',\n        // 资金类型\n        date1: '',\n        // 支出日期\n        personId: '',\n        // 经手人ID\n        personName: '',\n        // 经手人\n        amount: '',\n        // 金额\n        summary: '',\n        // 摘要\n        remark: '',\n        // 备注\n        state: -1\n      },\n      zclxData: '',\n      // 支出类型\n      zjlxData: [],\n      // 资金类型\n      cdmxData: [],\n      // 承兑明细列表\n      // 验证规则\n      rules: {\n        orgId: [{\n          required: true,\n          message: '请选择部门',\n          trigger: 'change'\n        }],\n        expendType: [{\n          required: true,\n          message: '请选择支出类型',\n          trigger: 'change'\n        }],\n        capitalType: [{\n          required: true,\n          message: '请选择资金类型',\n          trigger: 'change'\n        }],\n        expendDate: [{\n          required: true,\n          message: '请选择日期',\n          trigger: 'change'\n        }],\n        personId: [{\n          required: true,\n          message: '请选择经手人',\n          trigger: 'change'\n        }],\n        amount: [{\n          required: true,\n          message: '请输入金额',\n          trigger: 'change'\n        }, {\n          validator: _validate.validate.money,\n          message: '金额格式不正确'\n        }, {\n          validator: _validate.validate.max_amount,\n          message: '超过所能存储的最大金额'\n        }],\n        summary: [{\n          required: true,\n          message: '请输入摘要',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: {\n    /**\r\n     * 是否是承兑\r\n     */\n    isChengDui: function isChengDui() {\n      var capitalType = this.zcForm.capitalType;\n      return capitalType === 2 || capitalType === 3;\n    }\n  },\n  beforeRouteEnter: function beforeRouteEnter(to, from, next) {\n    next(function (vm) {\n      vm.initData();\n    });\n  },\n  // 组件方法\n  methods: {\n    /**\r\n     * @description: 初始化数据\r\n     */\n    initData: function initData() {\n      var _this$$route$query = this.$route.query,\n          type = _this$$route$query.type,\n          id = _this$$route$query.id;\n      if (!type) return;\n      this.type = type;\n      this.zcForm.id = id;\n\n      if (this.type === 'edit') {\n        this.getZcForm();\n      } else {\n        this.zcForm.state = 0;\n        this.$refs['ruleForm'] && this.$refs['ruleForm'].resetFields();\n        this.getOptions();\n      }\n    },\n\n    /**\r\n     * @description: 获取支出数据\r\n     */\n    getZcForm: function getZcForm() {\n      var _this = this;\n\n      (0, _Expend.GetExpendById)(this.zcForm.id).then(function (res) {\n        var code = res.code,\n            data = res.data,\n            expendTypeOptions = res.expendTypeOptions,\n            capitalTypeOptions = res.capitalTypeOptions;\n\n        if (code === 200) {\n          data.expendDate = _this.$moment(data.expendDate).format('YYYY-MM-DD');\n          _this.isCanUpdate = data.isCanUpdate;\n\n          for (var key in _this.zcForm) {\n            if (Object.hasOwnProperty.call(_this.zcForm, key)) {\n              _this.zcForm[key] = data[key];\n            }\n          } // acceptanceIDs\n          // this.zcForm.acceptanceList 暂时保留备份\n\n\n          if (Array.isArray(data.acceptanceList)) {\n            _this.cdmxData = _this.utils.easyDeepClone(data.acceptanceList); // this.zcForm.acceptanceIDs = data.acceptanceList.map(item => item.id)\n          } // data.acceptanceList\n          // if (Array.isArray()) {\n          //   this.zcForm.acceptanceList.forEach(ele => {\n          //     this.$set(ele, 'isEdit', false)\n          //     this.$set(ele, 'backups', JSON.stringify(ele))\n          //   })\n          // }\n\n\n          _this.zclxData = expendTypeOptions;\n          _this.zjlxData = capitalTypeOptions;\n        }\n      });\n    },\n\n    /**\r\n     * @description: 获取支出 资金 类型下拉\r\n     */\n    getOptions: function () {\n      var _getOptions = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _yield$GetExpendPagin, expendTypOptions, capitalTypeOptions;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return (0, _Expend.GetExpendPaging)({\n                  currentPage: 1,\n                  pageSize: 1\n                });\n\n              case 2:\n                _yield$GetExpendPagin = _context.sent;\n                expendTypOptions = _yield$GetExpendPagin.expendTypOptions;\n                capitalTypeOptions = _yield$GetExpendPagin.capitalTypeOptions;\n                this.zclxData = expendTypOptions;\n                this.zjlxData = capitalTypeOptions;\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getOptions() {\n        return _getOptions.apply(this, arguments);\n      }\n\n      return getOptions;\n    }(),\n\n    /**\r\n     * @description: 提交更新\r\n     */\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      this.$refs[formName].validate( /*#__PURE__*/function () {\n        var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(valid) {\n          var data, res;\n          return regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  if (!valid) {\n                    _context2.next = 11;\n                    break;\n                  }\n\n                  data = (0, _objectSpread2.default)((0, _objectSpread2.default)({}, _this2.zcForm), {}, {\n                    acceptanceIDs: _this2.cdmxData.map(function (v) {\n                      return v.id;\n                    })\n                  });\n\n                  if (!data.id) {\n                    delete data.id;\n                  }\n\n                  delete data.acceptanceList;\n                  _context2.next = 6;\n                  return (0, _Expend.SaveExpend)(data);\n\n                case 6:\n                  res = _context2.sent;\n\n                  _this2.utils.closeAndRefresh(_this2.$route.query.refreshRouterName);\n\n                  _this2.$message.success(res.message);\n\n                  _context2.next = 13;\n                  break;\n\n                case 11:\n                  console.log('error submit!!');\n                  return _context2.abrupt(\"return\", false);\n\n                case 13:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\r\n     * @description: 作废\r\n     */\n    invalidGathering: function () {\n      var _invalidGathering = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var _this3 = this;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                (0, _Expend.InvalidExpend)(this.zcForm.id).then(function (res) {\n                  _this3.$message.success(res.message);\n\n                  _this3.utils.closeAndRefresh(_this3.$route.query.refreshRouterName);\n                }).catch(function (err) {\n                  console.log(err); // this.$message.error(err.errorMsg || '操作失败')\n                });\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function invalidGathering() {\n        return _invalidGathering.apply(this, arguments);\n      }\n\n      return invalidGathering;\n    }(),\n    cancelForm: function cancelForm(formName) {\n      // this.$router({name:\"\"})\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName);\n    },\n\n    /**\r\n     * 承兑票选择完成回调\r\n     */\n    cdCheck: function cdCheck(newData) {\n      var sum = this.utils.sum;\n      this.cdmxData = newData; // this.zcForm.acceptanceIDs = Array.from(new Set(newData.map(item => item.id)))\n\n      this.zcForm.amount = sum(newData.map(function (v) {\n        return v.amount;\n      })).toFixed(2);\n    },\n\n    /**\r\n     * 选择资金形式后的回调,\r\n     * 选择承兑时需要清空承兑明细列表和资金总额\r\n     */\n    capitalTypeChange: function capitalTypeChange(value) {\n      this.cdmxData = [];\n\n      if (value === 2 || value === 3) {\n        this.zcForm.amount = 0;\n      }\n    }\n  }\n};\nexports.default = _default;",null]}