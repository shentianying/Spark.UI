{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js!D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\xmgl\\project\\projectEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\xmgl\\project\\projectEdit.vue","mtime":1630283963505},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _project = require(\"@/api/xmgl/project\");\n\nvar _UpFile = _interopRequireDefault(require(\"@/components/UpLoad/UpFile\"));\n\nvar _dictionary = require(\"@/api/xtgl/dictionary\");\n\nvar _accountSet = require(\"@/api/xtgl/accountSet\");\n\nvar _index = _interopRequireDefault(require(\"@/components/OrgSelect/index\"));\n\nvar _index2 = _interopRequireDefault(require(\"@/components/OrgSelect/index2\"));\n\nvar _selectBussinessInfo = _interopRequireDefault(require(\"@/components/Other/ywgl/selectBussinessInfo\"));\n\nvar _selectContract = _interopRequireDefault(require(\"@/components/Other/ywgl/selectContract\"));\n\nvar _flowSelect = _interopRequireDefault(require(\"@/components/Flow/flowSelect\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'ProjectEdit',\n  components: {\n    OrgSelect: _index.default,\n    OrgSelect2: _index2.default,\n    SelectBussinessInfo: _selectBussinessInfo.default,\n    SelectContract: _selectContract.default,\n    FlowSelect: _flowSelect.default,\n    UpFile: _UpFile.default\n  },\n  data: function data() {\n    return {\n      ruleForm: {\n        orgId: 0,\n        accountId: null,\n        managementiState: null,\n        stateID: null,\n        inUse: true,\n        isFictitious: false,\n        contractId: null,\n        bussinessInfoId: null,\n        zbFileList: [],\n        tbFileList: [],\n        sghtFileList: [],\n        bchtFileList: [],\n        psjlFileList: [],\n        zbtzsFileList: []\n      },\n      projectForm: {\n        companyId: this.$store.state.user.selectOrgId,\n        number: '',\n        projectId: 0,\n        state: 0,\n        billFlowId: 0\n      },\n      fileList: [],\n      accountList: [],\n      engPropertiesOptions: [],\n      managementiStateOptions: [],\n      structureTypeOptions: [],\n      informationSourceOptions: [],\n      taxTypeOptions: [],\n      projectPropertyOptions: [],\n      proPropertiesOptions: [],\n      stateTypeOptions: [],\n      projectCategoryOptions: [],\n      projectId: null,\n      buttonLoading: false,\n      isLoadFinish: false,\n      keyEngProperties: 0,\n      keyManagementiState: 0,\n      keyStructure: 0,\n      keyInformationSource: 0,\n      keyTaxType: 0,\n      keyProjectProperty: 0,\n      keyProProperties: 0,\n      keyState: 0,\n      keyOrg: 0,\n      disabled: true,\n      dialogTableVisible: false,\n      dialogTitle: '选择',\n      dialogWidth: '70%',\n      comName: 'SelectBussinessInfo',\n      selectValue: [],\n      multiple: false,\n      contractNumber: '',\n      bussinessInfoNumber: '',\n      billFlow: null,\n      active: 0,\n      loading: false,\n      rules: {\n        number: [{\n          required: true,\n          message: '必填',\n          trigger: 'blur'\n        }],\n        name: [{\n          required: true,\n          message: '必填',\n          trigger: 'blur'\n        }],\n        orgId: [{\n          required: true,\n          message: '必填',\n          trigger: 'blur'\n        }],\n        categoryId: [{\n          required: true,\n          message: '请选择',\n          trigger: 'blur'\n        }],\n        accountId: [{\n          required: true,\n          message: '请选择',\n          trigger: ['blur', 'change']\n        }]\n      }\n    };\n  },\n  watch: {\n    'ruleForm.orgId': {\n      handler: function handler(value) {\n        // this.ruleForm.accountId = null\n        if (value && value !== 0) {\n          this.disabled = false;\n        } else {\n          this.disabled = true;\n        }\n      },\n      immediate: true\n    }\n  },\n  created: function created() {},\n  mounted: function mounted() {\n    this.optionInit();\n    this.initData();\n  },\n  activated: function activated() {},\n  methods: {\n    submitForm: function submitForm(formName, state) {\n      var _this = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var newObj = JSON.parse(JSON.stringify(_this.ruleForm));\n          var tempIds = [];\n\n          if (newObj.zbFileList.length > 0) {\n            tempIds = newObj.zbFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          newObj.zbFileList = tempIds;\n          tempIds = [];\n\n          if (newObj.tbFileList.length > 0) {\n            tempIds = newObj.tbFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          newObj.tbFileList = tempIds;\n          tempIds = [];\n\n          if (newObj.sghtFileList.length > 0) {\n            tempIds = newObj.sghtFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          newObj.sghtFileList = tempIds;\n          tempIds = [];\n\n          if (newObj.bchtFileList.length > 0) {\n            tempIds = newObj.bchtFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          newObj.bchtFileList = tempIds;\n          tempIds = [];\n\n          if (newObj.psjlFileList.length > 0) {\n            tempIds = newObj.psjlFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          newObj.psjlFileList = tempIds;\n          tempIds = [];\n\n          if (newObj.zbtzsFileList.length > 0) {\n            tempIds = newObj.zbtzsFileList.map(function (m) {\n              return {\n                id: m.id,\n                addFlag: m.addFlag\n              };\n            });\n          }\n\n          newObj.zbtzsFileList = tempIds;\n          console.log(newObj);\n\n          if (state === 1) {\n            var projectObj = JSON.parse(JSON.stringify(_this.projectForm));\n            projectObj.orgId = newObj.orgId;\n            projectObj.projectId = newObj.id;\n            projectObj.state = state;\n            console.log(projectObj);\n\n            if (_this.billFlow) {\n              // 获取流程组件中的数据\n              var billFlow = _this.$refs.flowSelect.getBillFlow();\n\n              if (!billFlow) {\n                return false;\n              }\n\n              projectObj.billFlow = billFlow;\n            } else {\n              _this.$message('流程数据不能为空');\n\n              return;\n            }\n          } // var postData = { project: newObj, fileList: tempIds }\n\n\n          if (_this.projectId) {\n            // 修改\n            _this.buttonLoading = true;\n            (0, _project.putProject)(newObj).then(function (response) {\n              _this.$message(response.message);\n\n              if (state === 1) {\n                (0, _project.addProjectLX)(projectObj).then(function (response) {\n                  _this.$message(response.message);\n                });\n              }\n\n              _this.buttonLoading = false;\n\n              _this.closeThePage(); // this.$emit('dialogClose')\n\n            }).catch(function () {\n              _this.buttonLoading = false;\n            });\n          } else {\n            // 添加\n            _this.buttonLoading = true;\n            (0, _project.addProject)(newObj).then(function (response) {\n              _this.$message(response.message);\n\n              if (response.code === 200) {\n                if (state === 1) {\n                  projectObj.projectId = _this.response.data.id;\n                  (0, _project.addProjectLX)(projectObj).then(function (response) {\n                    _this.$message(response.message);\n                  });\n                }\n              }\n\n              _this.buttonLoading = false;\n\n              _this.closeThePage(); // this.$emit('dialogClose')\n\n            }).catch(function () {\n              _this.buttonLoading = false;\n            });\n          }\n        }\n      });\n    },\n    getDynamicFlow: function getDynamicFlow(formName) {\n      var _this2 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var newObj = JSON.parse(JSON.stringify(_this2.projectForm));\n          newObj.orgId = _this2.ruleForm.orgId;\n\n          if (!_this2.ruleForm.contractId) {\n            _this2.$message.error('提交立项申请必须关联合同!');\n\n            return;\n          }\n\n          (0, _project.getBillFlow)(newObj).then(function (response) {\n            if (response.success) {\n              _this2.billFlow = response.data.billFlow;\n              _this2.active = 1;\n            } else {\n              _this2.$message(response.message);\n            }\n          });\n        }\n      });\n    },\n    previous: function previous() {\n      // 上一步\n      this.active = 0;\n      this.billFlow = null;\n    },\n    initData: function initData() {\n      var _this3 = this;\n\n      this.projectId = this.$route.query.id;\n\n      if (this.projectId) {\n        (0, _project.getProjectById)({\n          id: this.projectId\n        }).then(function (response) {\n          var data = response.data,\n              incomeContract = response.incomeContract,\n              bussinessInfo = response.bussinessInfo; // const { data } = response\n\n          _this3.orgChange(data.orgId);\n\n          _this3.ruleForm = data;\n          _this3.ruleForm.zbFileList = data.zbUpFile;\n          _this3.ruleForm.tbFileList = data.tbUpFile;\n          _this3.ruleForm.sghtFileList = data.sghtUpFile;\n          _this3.ruleForm.bchtFileList = data.bchtUpFile;\n          _this3.ruleForm.psjlFileList = data.psjlUpFile;\n          _this3.ruleForm.zbtzsFileList = data.zbtzsUpFile;\n\n          if (incomeContract.length > 0) {\n            _this3.contractNumber = incomeContract[0].number;\n          }\n\n          if (bussinessInfo.length > 0) {\n            _this3.bussinessInfoNumber = bussinessInfo[0].number;\n          } // this.fileList = files\n          // this.keyEngProperties += 1\n          // this.keyManagementiState += 1\n          // this.keyStructureType += 1\n\n\n          _this3.keyInformationSource += 1; // this.keyTaxType += 1\n\n          _this3.keyProjectProperty += 1; // this.keyProProperties += 1\n          // this.keyStateType += 1\n\n          _this3.keyOrg += 1;\n        });\n      } else {\n        this.orgChange(0);\n      }\n    },\n    optionInit: function optionInit() {\n      var _this4 = this;\n\n      (0, _dictionary.getDictionarysByTypes)({\n        types: 'engProperties,managementiState,structureType,informationSource,taxType,projectProperty,proProperties,projectState,postPoolCategory'\n      }).then(function (response) {\n        var data = response.data;\n        data.forEach(function (element) {\n          element.pid = element.pId;\n\n          if (element.type === 'engProperties') {\n            _this4.engPropertiesOptions.push(element);\n          }\n\n          if (element.type === 'managementiState') {\n            _this4.managementiStateOptions.push(element);\n          }\n\n          if (element.type === 'structureType') {\n            _this4.structureTypeOptions.push(element);\n          }\n\n          if (element.type === 'informationSource') {\n            _this4.informationSourceOptions.push(element);\n          }\n\n          if (element.type === 'taxType') {\n            _this4.taxTypeOptions.push(element);\n          }\n\n          if (element.type === 'projectProperty') {\n            _this4.projectPropertyOptions.push(element);\n          }\n\n          if (element.type === 'proProperties') {\n            _this4.proPropertiesOptions.push(element);\n          }\n\n          if (element.type === 'projectState') {\n            _this4.stateTypeOptions.push(element);\n          }\n\n          if (element.type === 'postPoolCategory' && element.value > 3) {\n            _this4.projectCategoryOptions.push(element);\n          }\n        }); // this.keyEngProperties += 1\n        // this.keyManagementiState += 1\n        // this.keyStructureType += 1\n\n        _this4.keyInformationSource += 1; // this.keyTaxType += 1\n\n        _this4.keyProjectProperty += 1; // this.keyProProperties += 1\n        // this.keyStateType += 1\n      });\n    },\n    orgChange: function orgChange(data) {\n      var _this5 = this;\n\n      (0, _accountSet.getAccountSetByOrgId)({\n        orgId: data\n      }).then(function (response) {\n        _this5.accountList = response.data;\n      });\n    },\n    closeThePage: function closeThePage() {\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName);\n    },\n    fictitiousChange: function fictitiousChange(data) {\n      if (data) {\n        this.ruleForm.name = '【虚拟】' + this.ruleForm.name;\n      } else {\n        this.ruleForm.name = this.ruleForm.name.split('【虚拟】').join('');\n      }\n    },\n    selectBussinessInfo: function selectBussinessInfo() {\n      this.$refs.bussinessInfoRef.openDialog();\n    },\n    getBussinessInfo: function getBussinessInfo(data) {\n      if (data.length > 0) {\n        this.ruleForm.bussinessInfoId = data[0].id;\n        this.bussinessInfoNumber = data[0].number;\n      }\n    },\n    selectContract: function selectContract() {\n      this.$refs.contractRef.openDialog();\n    },\n    getContract: function getContract(data) {\n      if (data.length > 0) {\n        this.ruleForm.contractId = data[0].id;\n        this.contractNumber = data[0].number;\n      }\n    }\n  }\n};\nexports.default = _default;",null]}