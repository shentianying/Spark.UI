{"remainingRequest":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js!D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Projects\\spark\\Spark.UI\\src\\views\\cwgl\\byj\\Deposit\\Alteration.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Projects\\spark\\Spark.UI\\src\\views\\cwgl\\byj\\Deposit\\Alteration.vue","mtime":1635749455616},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Projects\\spark\\Spark.UI\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/Projects/spark/Spark.UI/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _flowSelect = _interopRequireDefault(require(\"@/components/Flow/flowSelect\"));\n\nvar _PersonSelect = _interopRequireDefault(require(\"@/components/SearchBar/form/PersonSelect\"));\n\nvar _UpFile = _interopRequireDefault(require(\"@/components/UpLoad/UpFile\"));\n\nvar _flowAttitude = _interopRequireDefault(require(\"@/components/Flow/flowAttitude\"));\n\nvar _Detailsedit = _interopRequireDefault(require(\"@/components/Detailsedit\"));\n\nvar _flowDisplay = _interopRequireDefault(require(\"@/components/Flow/flowDisplay\"));\n\nvar _Deposit = require(\"@/api/cwgl/Deposit.js\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default2 = {\n  components: {\n    PersonSelect: _PersonSelect.default,\n    UpFile: _UpFile.default,\n    FlowSelect: _flowSelect.default,\n    FlowAttitude: _flowAttitude.default,\n    Detailsedit: _Detailsedit.default,\n    FlowDisplay: _flowDisplay.default\n  },\n  props: {\n    type: {\n      // 审批:approval 新增:add\n      type: String,\n      default: 'add'\n    },\n    alteration: {\n      // 变更信息\n      type: Object,\n      default: null\n    },\n    details: {\n      // 详情信息\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {\n      size: 'mini',\n      currStep: 1,\n      // 步骤\n      saveLoading: false,\n      approvalForm: {\n        person: {\n          number: '',\n          name: ''\n        },\n        reason: '',\n        returnDate: '',\n        fileList: []\n      },\n      alterationForm: {\n        billFlow: null,\n        depositId: '',\n        state: 1,\n        id: 0,\n        personId: '',\n        name: '',\n        returnDate: '',\n        reason: '',\n        fileList: []\n      },\n      alterationRules: {\n        text: [{\n          required: true,\n          message: '请输入内容',\n          trigger: 'change'\n        }],\n        date: [{\n          required: true,\n          message: '请输入日期',\n          trigger: 'change'\n        }]\n      }\n    };\n  },\n  computed: {\n    isCurrUser: function isCurrUser() {\n      return this.$store.state.user.uid === this.alteration.createUserId;\n    },\n    attitudePara: function attitudePara() {\n      var _this$alteration = this.alteration,\n          billFlow = _this$alteration.billFlow,\n          id = _this$alteration.id,\n          billFlowId = _this$alteration.billFlowId;\n      return {\n        formId: billFlow === null || billFlow === void 0 ? void 0 : billFlow.formId,\n        billFlowId: billFlowId,\n        planId: id\n      };\n    },\n    alterationInfo: function alterationInfo() {\n      var _this = this;\n\n      var _this$alteration2 = this.alteration,\n          _this$alteration2$per = _this$alteration2.person,\n          number = _this$alteration2$per.number,\n          name = _this$alteration2$per.name,\n          reason = _this$alteration2.reason,\n          returnDate = _this$alteration2.returnDate,\n          upFile = _this$alteration2.upFile; // 数据格式化\n      // const m = (val) => this.utils.formatMoney(val, 2, 4)\n\n      var d = function d(dataStr) {\n        return dataStr ? _this.$moment(dataStr).format('YYYY-MM-DD') : dataStr;\n      }; // const a = this.utils.amountInWords\n\n\n      return [{\n        label: '经手人工号',\n        value: number\n      }, {\n        label: '经手人',\n        value: name\n      }, {\n        label: '回收日期',\n        value: d(returnDate),\n        monopolize: true\n      }, {\n        label: '变更原因',\n        value: reason,\n        monopolize: true\n      }, {\n        label: '附件',\n        value: upFile || [],\n        component: 'UpFile',\n        monopolize: true\n      }];\n    }\n  },\n  watch: {\n    details: {\n      immediate: true,\n      handler: function handler(val) {\n        if (val && !this.isSetSlterationForm) {\n          var _val$data = val.data,\n              name = _val$data.person.name,\n              personId = _val$data.personId,\n              planReturnDate = _val$data.planReturnDate,\n              upFile = _val$data.upFile;\n          Object.assign(this.alterationForm, {\n            returnDate: planReturnDate,\n            name: name,\n            personId: personId,\n            fileList: upFile || []\n          });\n        }\n      }\n    },\n    alteration: {\n      immediate: true,\n      handler: function handler(val) {\n        if (val) {\n          if (this.type === 'add') {\n            var name = val.person.name,\n                personId = val.personId,\n                reason = val.reason,\n                returnDate = val.returnDate,\n                upFile = val.upFile;\n            this.isSetSlterationForm = true;\n            Object.assign(this.alterationForm, {\n              returnDate: returnDate,\n              name: name,\n              reason: reason,\n              personId: personId,\n              fileList: upFile || []\n            });\n          } else {\n            this.approvalForm = (0, _objectSpread2.default)((0, _objectSpread2.default)({}, val), {}, {\n              fileList: val.upFile || []\n            });\n          }\n        }\n      }\n    }\n  },\n  methods: {\n    invalidForm: function invalidForm() {\n      var _this2 = this;\n\n      this.$confirm('是否确定作废？', '提示', {\n        type: 'warning'\n      }).then(function () {\n        _this2.saveLoading = true; // const attitude = this.$refs.flowAttitude.getPostData()\n\n        (0, _Deposit.DeleteDepositModify)({\n          id: _this2.alteration.id\n        }).then(function (res) {\n          if (res.code === 200) {\n            _this2.$message.success(res.message);\n\n            _this2.goBack(); // 跳转\n\n          } else {\n            _this2.$message.error(res.message);\n          }\n        }).finally(function () {\n          _this2.saveLoading = false;\n        });\n      });\n    },\n    saveFlow: function saveFlow() {\n      var _this3 = this;\n\n      var depositModify = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.alteration;\n      this.$confirm('是否确定保存？', '提示', {\n        type: 'warning'\n      }).then(function () {\n        _this3.saveLoading = true;\n\n        var attitude = _this3.$refs.flowAttitude.getPostData();\n\n        (0, _Deposit.CheckDepositModify)({\n          attitude: attitude,\n          depositModify: depositModify\n        }).then(function (res) {\n          if (res.code === 200) {\n            _this3.$message.success(res.message);\n\n            _this3.goBack(); // 跳转\n\n          } else {\n            _this3.$message.error(res.message);\n          }\n        }).finally(function () {\n          _this3.saveLoading = false;\n        });\n      });\n    },\n\n    /**\r\n     * 返回上一页，并关闭当前页\r\n     */\n    goBack: function goBack() {\n      this.utils.closeAndRefresh(this.$route.query.refreshRouterName);\n    },\n    selectPerson2: function selectPerson2(user) {\n      Object.assign(this.approvalForm.person, user);\n    },\n    selectPerson: function selectPerson(user) {\n      this.alterationForm.personId = user.id;\n      this.alterationForm.name = user.name;\n    },\n    setActive: function setActive(curr) {\n      this.currStep = curr;\n    },\n    submitForm: function submitForm() {\n      var _this4 = this;\n\n      var _this$details$data = this.details.data,\n          id = _this$details$data.id,\n          personId = _this$details$data.personId,\n          PlanReturnDate = _this$details$data.PlanReturnDate;\n      var req = (0, _objectSpread2.default)((0, _objectSpread2.default)({}, this.alterationForm), {}, {\n        depositId: id,\n        formerPersonId: personId,\n        formerReturnDate: PlanReturnDate\n      });\n\n      if (this.alterationForm.billFlow) {\n        var billFlow = this.$refs.flowSelect.getBillFlow();\n\n        if (billFlow) {\n          req.billFlow = billFlow;\n          (0, _Deposit.AddDepositModify)(req).then(function (res) {\n            // 添加\n            _this4.$message.success(res.message);\n\n            _this4.goBack();\n          });\n        } else {\n          return this.$message.error('获取流程数据失败');\n        }\n      } else {\n        return this.$message.error('流程数据不能为空');\n      }\n    },\n\n    /**\r\n     * 提交审批意见以后的回调函数\r\n     */\n    updateFlow: function updateFlow() {\n      // 直接返回\n      this.goBack();\n    },\n\n    /**\r\n     * @description: 变更下一步\r\n     */\n    nextStep: function nextStep(formName) {\n      var _this5 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var _this5$alteration;\n\n          // 获取流程数据\n          var _this5$details$data = _this5.details.data,\n              id = _this5$details$data.id,\n              personId = _this5$details$data.personId,\n              PlanReturnDate = _this5$details$data.PlanReturnDate,\n              orgId = _this5$details$data.orgId;\n          var req = (0, _objectSpread2.default)((0, _objectSpread2.default)({}, _this5.alterationForm), {}, {\n            orgId: orgId,\n            depositId: id,\n            formerPersonId: personId,\n            formerReturnDate: PlanReturnDate\n          });\n          if ((_this5$alteration = _this5.alteration) !== null && _this5$alteration !== void 0 && _this5$alteration.billFlowData) req.billFlowId = _this5.alteration.billFlowData.id;\n          (0, _Deposit.GetModifyBillFlow)(req).then(function (_ref) {\n            var data = _ref.data,\n                success = _ref.success,\n                message = _ref.message;\n\n            if (success) {\n              _this5.alterationForm.billFlow = data.billFlow;\n\n              _this5.setActive(2);\n            } else {\n              _this5.$message.error(message);\n            }\n          });\n        }\n      });\n    }\n  }\n};\nexports.default = _default2;",null]}